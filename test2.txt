To display real-time stock prices and changes for multiple companies on a single page in Django using yfinance, you can use a combination of HTML, JavaScript, and Django's built-in template system. Here are the general steps you can follow:

1. Install yfinance by running `pip install yfinance` in your terminal.

2. Create a Django view that fetches the current stock prices and changes for each company and renders a template with that data. You can use the yfinance library for this.

3. In the template, use JavaScript to periodically (e.g. every 5 seconds) make an AJAX request to another Django view that returns the updated stock prices and changes for each company. You can use the jQuery library to make the AJAX request.

4. Use JavaScript to update the HTML on the page with the new stock prices and changes.

Here's some sample code that demonstrates this approach:

1. views.py

import yfinance as yf
from django.shortcuts import render
from django.http import JsonResponse

def stocks(request):
    companies = ['AAPL', 'GOOG', 'MSFT']  # Replace with your list of companies
    data = {}
    for company in companies:
        stock = yf.Ticker(company)
        data[company] = {
            'price': stock.info['regularMarketPrice'],
            'change': stock.info['regularMarketChange'],
        }
    return render(request, 'stocks.html', {'data': data})

def stocks_data(request):
    companies = ['AAPL', 'GOOG', 'MSFT']  # Replace with your list of companies
    data = {}
    for company in companies:
        stock = yf.Ticker(company)
        data[company] = {
            'price': stock.info['regularMarketPrice'],
            'change': stock.info['regularMarketChange'],
        }
    return JsonResponse(data)


2. stocks.html

{% extends 'base.html' %}

{% block content %}
  <h1>Stocks</h1>
  <table>
    <thead>
      <tr>
        <th>Company</th>
        <th>Price</th>
        <th>Change</th>
      </tr>
    </thead>
    <tbody id="stocks-data">
      {% for company, stock in data.items %}
        <tr>
          <td>{{ company }}</td>
          <td>{{ stock.price }}</td>
          <td>{{ stock.change }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}

{% block scripts %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    function updateStocks() {
      $.ajax({
        url: '{% url "stocks_data" %}',
        success: function(data) {
          Object.keys(data).forEach(function(company) {
            var row = $('#stocks-data tr').filter(function() {
              return $(this).find('td:first-child').text() === company;
            });
            row.find('td:nth-child(2)').text(data[company].price);
            row.find('td:nth-child(3)').text(data[company].change);
          });
        }
      });
    }
    setInterval(updateStocks, 5000);
  </script>
{% endblock %}


3. urls.py

from django.urls import path
from . import views

urlpatterns = [
    path('stocks/', views.stocks, name='stocks'),
    path('stocks/data/', views.stocks_data, name='stocks_data'),
]


Note: This is just a basic example to get you started. You will need to modify it to fit your specific needs, such as customizing the HTML and CSS, and adding error handling.


To display the real-time stock prices for multiple companies on a single page using Django and yfinance, you can modify the stock_prices view to use a background task to periodically update the stock prices and push the updated data to the template using Django's AsyncWebsocketConsumer. Here's an example:

Install the required libraries:
pip install channels channels_redis
Update your Django settings to include the channels app and configure the ASGI_APPLICATION setting:
INSTALLED_APPS = [
    # ...
    'channels',
    # ...
]

ASGI_APPLICATION = 'myproject.routing.application'
Create a new file called routing.py in your project directory with the following contents:
from django.urls import re_path
from channels.routing import ProtocolTypeRouter, URLRouter
from channels.auth import AuthMiddlewareStack
from myapp.consumers import StockConsumer

application = ProtocolTypeRouter({
    "websocket": AuthMiddlewareStack(
        URLRouter([
            re_path('ws/stocks/$', StockConsumer.as_asgi()),
        ])
    ),
})
Create a new file called consumers.py in your app directory with the following contents:
import asyncio
import json
import yfinance as yf
from channels.generic.websocket import AsyncWebsocketConsumer

class StockConsumer(AsyncWebsocketConsumer):
    async def connect(self):
        await self.accept()

        self.tickers = ['AAPL', 'GOOG', 'MSFT'] # Replace with your own list of tickers
        self.interval = 5 # Update interval in seconds

        while True:
            await asyncio.sleep(self.interval)
            stocks = []
            for ticker in self.tickers:
                try:
                    stock = yf.Ticker(ticker)
                    price = stock.info['regularMarketPrice']
                    change = stock.info['regularMarketChangePercent']
                    stocks.append({
                        'symbol': ticker,
                        'price': price,
                        'change': change
                    })
                except Exception as e:
                    stocks.append({
                        'symbol': ticker,
                        'error_message': str(e)
                    })

            await self.send(text_data=json.dumps({
                'type': 'stock_data',
                'data': stocks
            }))
Update your views.py file to render the stock_prices.html template:
from django.shortcuts import render

def stock_prices(request):
    return render(request, 'stock_prices.html')
Create a new file called stock_prices.html in your app's templates directory with the following contents:
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Real-Time Stock Prices</title>
</head>
<body>
    <h1>Real-Time Stock Prices</h1>
    <table>
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Price</th>
                <th>Change</th>
            </tr>
        </thead>
        <tbody id="stock-table-body">
        </tbody>
    </table>

    <script>
        const socket = new WebSocket('ws://' + window.location.host + '/ws/stocks/');

        socket.onmessage = function(event) {
            const message = JSON.parse(event.data);

            if (message.type === 'stock_data') {
                const stocks = message.data;

                const stockTableBody = document.getElementById('stock-table-body');
                stockTableBody.innerHTML = '';

                for (let i = 0; i < stocks.length; i++) {
                    const stock = stocks[i];

                    const row = document.createElement('tr');

                    const symbolCell = document.createElement('td');
                    symbolCell.textContent = stock.symbol;
                    row.appendChild(symbolCell);

                    const priceCell = document.createElement('td');
                    priceCell.textContent = stock.price;
                    row.appendChild(priceCell);

                    const changeCell = document.createElement('td');
                    changeCell.textContent = stock.change + '%';
                    row.appendChild(changeCell);

                    stockTableBody.appendChild(row);
                }
            }
        };
    </script>
</body>
</html>
Update your urls.py file to include a URL pattern for the stock_prices view:
from django.urls import path
from .views import stock_prices

urlpatterns = [
    path('stock-prices/', stock_prices, name='stock_prices'),
    # ...
]
Now, when you visit the stock-prices URL, you should see a table of real-time stock prices for the tickers specified in the StockConsumer class. The table will automatically update every 5 seconds with the latest data.